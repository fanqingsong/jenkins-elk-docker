version: "3.1"

services:
  myjenkins:
    build:
      context: .
      network: host
    image: myjenkins
    ports:
     - "8080:8080"
    # depends_on:
    #  - mysonar
    #  - artifactory
    # links:
    #   - mysonar
    #   - artifactory
    volumes:
     - "./jobs:/var/jenkins_home/jobs/"
     - "./m2deps:/var/jenkins_home/.m2/repository/"
     - "./downloads:/var/jenkins_home/downloads"
    secrets:
     - artifactoryPassword

  # mysonar:
  #   image: sonarqube:6.3.1
  #   ports:
  #    - "9000:9000"

  # artifactory:
  #   image: docker.bintray.io/jfrog/artifactory-oss:5.4.4
  #   ports:
  #    - "8081:8081"

  logstash:
    image: logstash:5.0.0
    # volumes:
    #       - ./:/config
    # command: logstash
    links:
     - elasticsearch
    depends_on:
     - elasticsearch

  elasticsearch:
     image: elasticsearch:5.0.0
     ports:
      - "9200:9200"

  kibana:
    image: kibana:5.0.0
    ports:
     - "5601:5601"
    links:
     - elasticsearch
    environment:
      ELASTICSEARCH_URL: http://elasticsearch:9200
    depends_on:
     - elasticsearch

secrets:
  artifactoryPassword:
    file: ./secrets/artifactoryPassword

networks:
  default:
    driver: bridge

